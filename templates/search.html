{% extends 'base.html' %} {% block content%}
<section class="search-header mb-2">
  <div class="container">
    <h1>Weather forecast</h1>
    <hr />
    <form class="d-flex" action="" method="GET">
      {{form.search(class_="form-control search-input", required='required', placeholder="London, New York, Stockholm, Paris")}}
      <div class="btn-group">
        <button class="search-button btn btn-primary" type="submit" style="border-right: #0069d9 solid 2px;"><i class="fas fa-search"></i></button>
        <button class="search-button search-button-location btn btn-primary" type="submit" style="border-left: #0069d9 solid 2px;"><i class="fas fa-map-marker-alt"></i></button>
      </div>
    </form>
  </div>
</section>
{% if data.cod == "404"%}
<hr />
<section class="py-5">
  <div class="container text-center">
    <h1 class="display-1">404</h1>
    <h1>City not found</h1>
    <p class="lead">The clouds didint reach your search, try checking the name of the city</p>
  </div>
</section>
{% else %}
<div id="loader"></div>
<section class="py-5 animate-bottom" id="mainSection">
  <div class="container">
    <div class="row mb-3">
      <div class="col-lg-6 p-0">
        <h1 class="display-4 mb-4">Weather in <br />{{data.name}}, <small>{{data["sys"]["country"]}}</small></h1>
        <div class="d-flex">
          <canvas id="weather-icon" width="75" height="75" class="mr-3"></canvas>
          <p id="weather-temprature" class="weather-temprature" style="--c: '°c';">{{data["main"]["temp"]|round|int}}</p>
          <div class="onoffswitch">
            <input type="checkbox" name="onoffswitch" class="onoffswitch-checkbox" id="myonoffswitch" checked onclick="celcuis_to_fehrenheit()" />
            <label class="onoffswitch-label" for="myonoffswitch">
              <span class="onoffswitch-inner"></span>
              <span class="onoffswitch-switch" style="height: 18px; margin-top: 8px;"></span>
            </label>
          </div>
        </div>
        <p class=" weather-desc"><small>{{data["weather"][0]["description"]}}</small></p>
      </div>
      <div class="col-lg-6 p-0" style="height: 270px;">
        <div class="h-100">
          <img class="img-fluid w-100 h-100 o" src="{{img}}" alt="" />
        </div>
        <hr />
      </div>
    </div>
    <div class="row">
      <div class="col-lg-6"></div>
      <div class="col-lg-6">
        <canvas id="wind-icon" width="75" height="75" class="mr-3"></canvas>
      </div>
    </div>
  </div>
</section>
{% set sunset = data["sys"]["sunset"] %}
<p class="d-none" id="weatherId">{% for i in data["weather"] %} {{ i['id']}} {% endfor %}</p>
<script>
  var myVar;

  function loading() {
    myVar = setTimeout(showPage, 2000);
  }

  function showPage() {
    document.getElementById("loader").style.display = "none";
    document.getElementById("mainSection").style.display = "inherit";
  }
</script>
<script>
  function celcuis_to_fehrenheit() {
    var temp = document.getElementById("weather-temprature");
    var switchy = document.getElementById("myonoffswitch");

    var isChecked = switchy.checked;
    if (isChecked == false) {
      fehrenheit = temp.innerHTML * 1.8 + 32;

      temp.innerHTML = Math.round(fehrenheit);
      temp.style.setProperty("--c", "'°F'");
    } else if (isChecked == true) {
      celcuis = (temp.innerHTML - 32) * (5 / 9);

      temp.innerHTML = Math.round(celcuis);
      temp.style.setProperty("--c", "'°c'");
    }
  }
</script>
<script>
  console.log({{ data| tojson}});

  const weatherStatus = parseInt(weatherId.textContent);
  console.log(weatherStatus)

  var skycons = new Skycons({ color: "#2f303a" });
  var skyconsWind = new Skycons({ color: "#2f303a" });

  var sunset_time = {{ sunset| tojson}};
  var sunset = new Date(sunset_time * 1000);

  skyconsWind.add("wind-icon", Skycons.WIND);
  skyconsWind.play();

  skycons.add("weather-icon", Skycons.PARTLY_CLOUDY_NIGHT);
  skycons.play();

  if (weatherStatus == 800) {
    skycons.set("weather-icon", Skycons.CLEAR_DAY);
  } else if (weatherStatus == 801 || weatherStatus == 802) {
    skycons.set("weather-icon", Skycons.PARTLY_CLOUDY_DAY);
  } else if (weatherStatus == 803 || weatherStatus == 804) {
    skycons.set("weather-icon", Skycons.CLOUDY);
  } else if (weatherStatus == 500 || weatherStatus == 501) {
    skycons.set("weather-icon", Skycons.RAIN);
  } else if (weatherStatus == 502 || weatherStatus == 503 || weatherStatus == 504) {
    skycons.set("weather-icon", Skycons.SLEET);
  } else if (weatherStatus == 511) {
    skycons.set("weather-icon", Skycons.SNOW);
  } else if (weatherStatus == 520 || weatherStatus == 521 || weatherStatus == 522 || weatherStatus == 531) {
    skycons.set("weather-icon", Skycons.SLEET);
  } else if (weatherStatus == 600 || weatherStatus == 601 || weatherStatus == 602 || weatherStatus == 616) {
    skycons.set("weather-icon", Skycons.SNOW);
  } else if (weatherStatus == 611 || weatherStatus == 612 || weatherStatus == 613 || weatherStatus == 615) {
    skycons.set("weather-icon", Skycons.SLEET);
  } else if (weatherStatus == 701 || weatherStatus == 711 || weatherStatus == 721 || weatherStatus == 731 || weatherStatus == 741) {
    skycons.set("weather-icon", Skycons.FOG);
  } else {
    skycons.set("weather-icon", Skycons.CLOUDY);
  }
</script>
{% endif %} {% endblock %}
